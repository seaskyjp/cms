"use strict";(self.webpackChunkseaskyCMS=self.webpackChunkseaskyCMS||[]).push([[234],{4234:($,h,s)=>{s.r(h),s.d(h,{EditMessageModule:()=>V});var v=s(4755),m=s(1195),c=s(5861),i=s(5030),A=s(9751),Q=s(2340),n=s(2223),L=s(131),b=s(3272),E=s(8397),Z=s(4259),I=s(2242),U=s(4247),M=s(4839),T=s(6681),C=s(1929),d=s(4701),y=s(2701),S=s(3068),f=s(8942),D=s(3355);function B(o,r){if(1&o){const e=n.EpF();n.TgZ(0,"button",21),n.NdJ("click",function(){n.CHM(e);const a=n.oxw();return n.KtG(a.edit())}),n._uU(1,"\u7de8\u96c6"),n.qZA()}}function X(o,r){if(1&o){const e=n.EpF();n.TgZ(0,"button",21),n.NdJ("click",function(){n.CHM(e);const a=n.oxw();return n.KtG(a.cancel())}),n._uU(1,"\u30ad\u30e3\u30f3\u30bb\u30eb"),n.qZA()}}function N(o,r){if(1&o&&(n.ynx(0),n._UZ(1,"span",22),n.TgZ(2,"div",23),n._uU(3,"Upload"),n.qZA(),n.BQk()),2&o){const e=n.oxw();n.xp6(1),n.Q6J("nzType",e.isImgLoading?"loading":"plus")}}function Y(o,r){if(1&o&&n._UZ(0,"img",24),2&o){const e=n.oxw();n.Q6J("src",e.form.value.img,n.LSH)}}const R=function(){return[".png",".jpg"]},H=[{path:"",component:(()=>{class o{constructor(e,t,a,l,g){this.router=e,this.route=t,this.supabase=a,this.message=l,this.fb=g,this.id="",this.isLoading=!1,this.isImgLoading=!1,this.isEdit=!1,this.content="",this.transformFile=J=>new A.y(F=>{const p=new FileReader;p.readAsDataURL(J),this.uploadImages(J),p.onload=()=>{const x=document.createElement("canvas"),z=document.createElement("img");z.src=p.result,z.onload=()=>{const u=x.getContext("2d");u.drawImage(z,0,0),u.fillStyle="red",u.textBaseline="middle",u.fillText("Ant Design",20,20),x.toBlob(K=>{F.next(K),F.complete()})}}})}ngOnInit(){this.id="1",this.form=this.fb.group({id:[null],created_at:[null],updated_at:[null],content:[null],ceo:[null,[i.kI.required]],img:[null,[i.kI.required]]}),this.cancel(),this.id&&this.getDetails(+this.id)}getDetails(e){var t=this;return(0,c.Z)(function*(){t.isLoading=!0;const{data:a,error:l}=yield t.supabase.get("message",e,!0);l&&t.message.error(l.message),console.log(a),t.content=a.content,t.form.setValue({...a}),t.isLoading=!1})()}onChange(e){console.log("onChange: ",e)}submitForm(){var e=this;return(0,c.Z)(function*(){if(e.form.valid){e.form.value.content=e.content,console.log(e.form.value);const{error:t}=yield e.supabase.upsert("message",e.form.value);t?e.message.error(t.message):(e.message.success("Success"),e.cancel())}else Object.values(e.form.controls).forEach(t=>{t.invalid&&(t.markAsDirty(),t.updateValueAndValidity({onlySelf:!0}))})})()}edit(){this.isEdit=!0,this.form.controls.ceo.enable()}cancel(){this.isEdit=!1,this.form.controls.ceo.disable()}uploadImages(e){var t=this;return(0,c.Z)(function*(){const a=e.name.split(".").pop(),l=`${Math.random()}.${a}`;t.isImgLoading=!0;const{error:g}=yield t.supabase.uploadImages(l,e);g&&t.message.error(g.message),t.form.value.img=`${Q.N.storageUrl}${l}`,t.form.setValue({...t.form.value}),t.isImgLoading=!1})()}}return o.\u0275fac=function(e){return new(e||o)(n.Y36(m.F0),n.Y36(m.gz),n.Y36(L.T),n.Y36(b.dD),n.Y36(i.QS))},o.\u0275cmp=n.Xpm({type:o,selectors:[["app-edit-message"]],decls:33,vars:29,consts:[["nzHeader","\u4f8b","nzActive","false"],["src","assets/img/message.png",2,"width","100%","height","auto"],["nzHeader","\u30c7\u30fc\u30bf","nzActive","true"],[3,"nzSpinning"],[1,"header-wrap"],[1,"header-title"],["class","header-button","nz-button","","nzType","primary",3,"click",4,"ngIf"],[1,"content-wrap"],["nz-form","",3,"formGroup","ngSubmit"],["nzRequired","","nzFor","content",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],[2,"line-height","1.5 !important",3,"content","readonlyflag","contentChange"],["nzRequired","","nzFor","ceo",3,"nzSm","nzXs"],["nz-input","","formControlName","ceo","id","ceo"],["nzRequired","","nzFor","img",3,"nzSm","nzXs"],["nzListType","picture-card",1,"uploader",3,"nzDisabled","nzShowUploadList","nzAccept","nzTransformFile"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["nz-row","",1,"register-area"],[3,"nzSpan","nzOffset"],["nz-button","","nzType","primary",3,"disabled","nzLoading"],["nz-button","","nzType","primary",1,"header-button",3,"click"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"]],template:function(e,t){1&e&&(n.TgZ(0,"nz-collapse")(1,"nz-collapse-panel",0),n._UZ(2,"img",1),n.qZA(),n.TgZ(3,"nz-collapse-panel",2)(4,"nz-spin",3)(5,"div",4),n._UZ(6,"div",5),n.YNc(7,B,2,0,"button",6),n.YNc(8,X,2,0,"button",6),n.qZA(),n._UZ(9,"nz-divider"),n.TgZ(10,"div",7)(11,"form",8),n.NdJ("ngSubmit",function(){return t.submitForm()}),n.TgZ(12,"nz-form-item")(13,"nz-form-label",9),n._uU(14,"Content"),n.qZA(),n.TgZ(15,"nz-form-control",10)(16,"app-content-editor",11),n.NdJ("contentChange",function(l){return t.content=l}),n.qZA()()(),n.TgZ(17,"nz-form-item")(18,"nz-form-label",12),n._uU(19,"CEO"),n.qZA(),n.TgZ(20,"nz-form-control",10),n._UZ(21,"input",13),n.qZA()(),n.TgZ(22,"nz-form-item")(23,"nz-form-label",14),n._uU(24,"Image"),n.qZA(),n.TgZ(25,"nz-form-control",10)(26,"nz-upload",15),n.YNc(27,N,4,1,"ng-container",16),n.YNc(28,Y,1,1,"img",17),n.qZA()()(),n.TgZ(29,"nz-form-item",18)(30,"nz-form-control",19)(31,"button",20),n._uU(32,"\u4fdd\u5b58"),n.qZA()()()()()()()()),2&e&&(n.xp6(4),n.Q6J("nzSpinning",t.isLoading),n.xp6(3),n.Q6J("ngIf",!t.isEdit),n.xp6(1),n.Q6J("ngIf",t.isEdit),n.xp6(3),n.Q6J("formGroup",t.form),n.xp6(2),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(1),n.Q6J("content",t.content)("readonlyflag",!t.isEdit),n.xp6(2),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(3),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(1),n.Q6J("nzDisabled",!t.isEdit)("nzShowUploadList",!1)("nzAccept",n.DdM(28,R))("nzTransformFile",t.transformFile),n.xp6(1),n.Q6J("ngIf",!t.form.value.img),n.xp6(1),n.Q6J("ngIf",t.form.value.img),n.xp6(2),n.Q6J("nzSpan",6)("nzOffset",6),n.xp6(1),n.Q6J("disabled",!t.isEdit)("nzLoading",t.isLoading||t.isImgLoading))},dependencies:[v.O5,i._Y,i.Fj,i.JJ,i.JL,i.sg,i.u,E.Zp,Z.ix,I.w,U.dQ,M.g,T.W,C.t3,C.SK,d.Lr,d.Nx,d.iK,d.Fd,y.Ls,S.FY,f.Zv,f.yH,D.F]}),o})()}];let O=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[m.Bz.forChild(H),m.Bz]}),o})();var j=s(3247),G=s(4233);let V=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=n.oAB({type:o}),o.\u0275inj=n.cJS({imports:[v.ez,O,i.UX,E.o7,Z.sL,M.S,j.HQ,T.j,d.U5,y.PV,S.cS,i.u5,f.cD,G.m]}),o})()}}]);