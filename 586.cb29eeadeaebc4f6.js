"use strict";(self.webpackChunkseaskyCMS=self.webpackChunkseaskyCMS||[]).push([[586],{2586:(W,x,a)=>{a.r(x),a.d(x,{EditShowcaseModule:()=>K});var Z=a(4755),S=a(1195),u=a(5861),r=a(5030),B=a(7489),J=a(9751),C=a(2340),n=a(2223),M=a(131),X=a(3272),U=a(8397),Q=a(4259),D=a(2242),N=a(4247),E=a(4839),F=a(6681),A=a(1929),p=a(4701),L=a(2701),w=a(3068),v=a(2839),T=a(8942),R=a(3355);function Y(e,l){if(1&e&&(n.TgZ(0,"label",24),n._uU(1),n.qZA()),2&e){const o=l.$implicit;n.Q6J("nzValue",o.id),n.xp6(1),n.Oqu(o.name)}}function b(e,l){if(1&e&&(n.ynx(0),n._UZ(1,"span",25),n.TgZ(2,"div",26),n._uU(3,"Upload"),n.qZA(),n.BQk()),2&e){const o=n.oxw();n.xp6(1),n.Q6J("nzType",o.loading?"loading":"plus")}}function O(e,l){if(1&e&&n._UZ(0,"img",27),2&e){const o=n.oxw();n.Q6J("src",o.avatarUrl,n.LSH)}}function $(e,l){if(1&e&&(n.ynx(0),n._UZ(1,"span",25),n.TgZ(2,"div",26),n._uU(3,"Upload"),n.qZA(),n.BQk()),2&e){const o=n.oxw();n.xp6(1),n.Q6J("nzType",o.isImgLoading?"loading":"plus")}}function V(e,l){if(1&e&&n._UZ(0,"img",27),2&e){const o=n.oxw();n.Q6J("src",o.form.value.img,n.LSH)}}const I=function(){return[".png",".jpg"]},j=[{path:"",component:(()=>{class e{constructor(o,t,s,i,m){this.router=o,this.route=t,this.supabase=s,this.message=i,this.fb=m,this.id="",this.isLoading=!1,this.isImgLoading=!1,this.cat=0,this.tags=[],this.loading=!1,this.details="",this.transformFile=z=>new J.y(f=>{const c=new FileReader;c.readAsDataURL(z),this.uploadImages(z),c.onload=()=>{const h=document.createElement("canvas"),g=document.createElement("img");g.src=c.result,g.onload=()=>{const d=h.getContext("2d");d.drawImage(g,0,0),d.fillStyle="red",d.textBaseline="middle",d.fillText("Ant Design",20,20),h.toBlob(y=>{f.next(y),f.complete()})}}}),this.transformFileSec=z=>new J.y(f=>{const c=new FileReader;c.readAsDataURL(z),this.uploadImagesSec(z),c.onload=()=>{const h=document.createElement("canvas"),g=document.createElement("img");g.src=c.result,g.onload=()=>{const d=h.getContext("2d");d.drawImage(g,0,0),d.fillStyle="red",d.textBaseline="middle",d.fillText("Ant Design",20,20),h.toBlob(y=>{f.next(y),f.complete()})}}})}ngOnInit(){this.getCate(),this.id=this.route.snapshot.params.id||"",this.form=this.fb.group({id:[null],cat:[null],created_at:[null],updated_at:[null],title:[null,[r.kI.required]],desc:[null,[r.kI.required]],details:[null],img:[null,[r.kI.required]]}),this.id&&this.getDetails(+this.id)}getDetails(o){var t=this;return(0,u.Z)(function*(){t.isLoading=!0;const{data:s,error:i}=yield t.supabase.get("showcase",o,!0);i&&t.message.error(i.message),console.log(s),t.form.setValue({...s}),t.cat=s.cat,t.details=s.details,t.isLoading=!1})()}goBack(){this.router.navigateByUrl("showcase")}submitForm(){var o=this;return(0,u.Z)(function*(){if(o.form.valid){console.log(o.form.value),o.form.value.details=o.details;const{error:t}=yield o.supabase.upsert("showcase",o.form.value);t?o.message.error(t.message):(o.message.success("Success"),o.goBack())}else Object.values(o.form.controls).forEach(t=>{t.invalid&&(t.markAsDirty(),t.updateValueAndValidity({onlySelf:!0}))})})()}getCate(){var o=this;return(0,u.Z)(function*(){o.isLoading=!0;const{data:t,error:s}=yield o.supabase.get("showcase_cat");s&&o.message.error(s.message),o.tags=B.sortBy(t,["created_at"])||[],o.isLoading=!1})()}uploadImages(o){var t=this;return(0,u.Z)(function*(){const s=o.name.split(".").pop(),i=`${Math.random()}.${s}`;t.isImgLoading=!0;const{error:m}=yield t.supabase.uploadImages(i,o);m&&t.message.error(m.message),t.form.value.img=`${C.N.storageUrl}${i}`,t.form.setValue({...t.form.value}),t.isImgLoading=!1})()}uploadImagesSec(o){var t=this;return(0,u.Z)(function*(){const s=o.name.split(".").pop(),i=`${Math.random()}.${s}`;t.loading=!0;const{error:m}=yield t.supabase.uploadImages(i,o);m&&t.message.error(m.message),t.avatarUrl=`${C.N.storageUrl}${i}`,t.loading=!1})()}}return e.\u0275fac=function(o){return new(o||e)(n.Y36(S.F0),n.Y36(S.gz),n.Y36(M.T),n.Y36(X.dD),n.Y36(r.QS))},e.\u0275cmp=n.Xpm({type:e,selectors:[["app-edit-showcase"]],decls:44,vars:38,consts:[[3,"nzSpinning"],[1,"header-wrap"],[1,"header-title"],["nz-button","","nzType","primary",1,"header-button",3,"click"],[1,"content-wrap"],["nz-form","",3,"formGroup","ngSubmit"],["nzRequired","","nzFor","cat",3,"nzSm","nzXs"],["formControlName","cat","nzButtonStyle","solid",3,"ngModel","ngModelChange"],["nz-radio-button","",3,"nzValue",4,"ngFor","ngForOf"],["nzRequired","","nzFor","title",3,"nzSm","nzXs"],[3,"nzSm","nzXs"],["nz-input","","formControlName","title","id","title"],["nzRequired","","nzFor","desc",3,"nzSm","nzXs"],["nz-input","","formControlName","desc","id","desc"],["nzRequired","","nzFor","details",3,"nzSm","nzXs"],["nzHeader","\u5c55\u958b\u3057\u307e\u3059","nzActive","false"],["nzListType","picture-card",1,"uploader",3,"nzShowUploadList","nzAccept","nzTransformFile"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],[2,"line-height","1.5 !important",3,"content","contentChange"],["nzRequired","","nzFor","img",3,"nzSm","nzXs"],["nz-row","",1,"register-area"],[3,"nzSpan","nzOffset"],["nz-button","","nzType","primary",3,"nzLoading"],["nz-radio-button","",3,"nzValue"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"]],template:function(o,t){1&o&&(n.TgZ(0,"nz-spin",0)(1,"div",1),n._UZ(2,"div",2),n.TgZ(3,"button",3),n.NdJ("click",function(){return t.goBack()}),n._uU(4,"\u623b\u3063\u3066"),n.qZA()(),n._UZ(5,"nz-divider"),n.TgZ(6,"div",4)(7,"form",5),n.NdJ("ngSubmit",function(){return t.submitForm()}),n.TgZ(8,"nz-form-item")(9,"nz-form-label",6),n._uU(10,"Category"),n.qZA(),n.TgZ(11,"nz-radio-group",7),n.NdJ("ngModelChange",function(i){return t.cat=i}),n.YNc(12,Y,2,2,"label",8),n.qZA()(),n.TgZ(13,"nz-form-item")(14,"nz-form-label",9),n._uU(15,"Title"),n.qZA(),n.TgZ(16,"nz-form-control",10),n._UZ(17,"input",11),n.qZA()(),n.TgZ(18,"nz-form-item")(19,"nz-form-label",12),n._uU(20,"Description"),n.qZA(),n.TgZ(21,"nz-form-control",10),n._UZ(22,"input",13),n.qZA()(),n.TgZ(23,"nz-form-item")(24,"nz-form-label",14),n._uU(25,"Details"),n.qZA(),n.TgZ(26,"nz-form-control",10)(27,"nz-collapse")(28,"nz-collapse-panel",15)(29,"nz-upload",16),n.YNc(30,b,4,1,"ng-container",17),n.YNc(31,O,1,1,"img",18),n.qZA(),n.TgZ(32,"app-content-editor",19),n.NdJ("contentChange",function(i){return t.details=i}),n.qZA()()()()(),n.TgZ(33,"nz-form-item")(34,"nz-form-label",20),n._uU(35,"Image"),n.qZA(),n.TgZ(36,"nz-form-control",10)(37,"nz-upload",16),n.YNc(38,$,4,1,"ng-container",17),n.YNc(39,V,1,1,"img",18),n.qZA()()(),n.TgZ(40,"nz-form-item",21)(41,"nz-form-control",22)(42,"button",23),n._uU(43,"\u4fdd\u5b58"),n.qZA()()()()()()),2&o&&(n.Q6J("nzSpinning",t.isLoading),n.xp6(7),n.Q6J("formGroup",t.form),n.xp6(2),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("ngModel",t.cat),n.xp6(1),n.Q6J("ngForOf",t.tags),n.xp6(2),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(3),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(3),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(3),n.Q6J("nzShowUploadList",!1)("nzAccept",n.DdM(36,I))("nzTransformFile",t.transformFileSec),n.xp6(1),n.Q6J("ngIf",!t.avatarUrl),n.xp6(1),n.Q6J("ngIf",t.avatarUrl),n.xp6(1),n.Q6J("content",t.details),n.xp6(2),n.Q6J("nzSm",6)("nzXs",24),n.xp6(2),n.Q6J("nzSm",14)("nzXs",24),n.xp6(1),n.Q6J("nzShowUploadList",!1)("nzAccept",n.DdM(37,I))("nzTransformFile",t.transformFile),n.xp6(1),n.Q6J("ngIf",!t.form.value.img),n.xp6(1),n.Q6J("ngIf",t.form.value.img),n.xp6(2),n.Q6J("nzSpan",14)("nzOffset",6),n.xp6(1),n.Q6J("nzLoading",t.isLoading||t.isImgLoading))},dependencies:[Z.sg,Z.O5,r._Y,r.Fj,r.JJ,r.JL,r.sg,r.u,U.Zp,Q.ix,D.w,N.dQ,E.g,F.W,A.t3,A.SK,p.Lr,p.Nx,p.iK,p.Fd,L.Ls,w.FY,v.Of,v.Bq,v.Dg,T.Zv,T.yH,R.F]}),e})()}];let H=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[S.Bz.forChild(j),S.Bz]}),e})();var G=a(3247),P=a(4233);let K=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[Z.ez,H,r.UX,U.o7,Q.sL,E.S,G.HQ,F.j,p.U5,L.PV,w.cS,v.aF,r.u5,T.cD,P.m]}),e})()}}]);